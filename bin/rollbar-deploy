#!/bin/bash
set -e

REQUEST=$(cat <<EOF
  {
    "access_token":"$ROLLBAR_ACCESS_TOKEN",
    "environment":"$SEMAPHORE_SERVER_NAME",
    "revision":"$REVISION",
    "local_username":"$DEPLOY_AUTHOR_NAME",
    "comment":"$TAG",
    "status": "$DEPLOY_STATUS"
  }
EOF
)

if [ -n "$ROLLBAR_ACCESS_TOKEN" ]; then
  curl -f -v --request POST \
     --url https://api.rollbar.com/api/1/deploy/ \
     --data "${REQUEST}"
fi
exit 0
